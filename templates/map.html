<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../static/style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Кафе на карте</title>
        <script src='https://mapgl.2gis.com/api/js/v1'></script>
        <style>
            #map {
                width: 100%;
                height: 500px;
            }
        </style>
    </head>
    <body>
        <h1>Marketplaces Map</h1>
        <div id="map"></div>

        <script>
            const map = new mapgl.Map('map', {
                center: [37.6173, 55.7558],
                zoom: 15,
                key: 'ab7b70c9-9132-468f-8b4c-87177a2418cf',
            });
    
            navigator.geolocation.getCurrentPosition(function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
    
                map.setCenter([lon, lat]);

                console.log(lat + ', ' + lon)

                fetch('/cafes/' + lat + '/' + lon)
                    .then(response => response.json())
                    .then(cafes => {
                        cafes.forEach(cafe => {
                            const marker = new mapgl.Marker(map, {
                                coordinates: [cafe.point.lon, cafe.point.lat],
                            });
                        });
                    });
            });
        </script>
    </body>
</html>