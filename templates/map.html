<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../static/style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Кафе на карте</title>
        <script src='https://mapgl.2gis.com/api/js/v1'></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    </head>
    <body>
        <div class="row" style="height: 70px; max-width: 500px; position: absolute; z-index: 1000">
            <div class="row bg-color-base" style="width: 90%; height: 70%; border-radius: 20px;">
                <form method="post" novalidate action="location_search">
                    <div class="block" style="width: 80%">
                        <input type="text" name="location_search_bar" placeholder="Поиск" required>
                    </div>
                    <div class="block" style="width: 20%">
                        <button type="submit" style="width: 100%; height: 100%;"><p class="material-symbols-outlined color-contour2" style="font-size: 200%;">search</p></button>
                    </div>
                </form>
            </div>
        </div>

        <div id="map" class="block" style="background-color: aqua;"></div>
        <script>
            const map = new mapgl.Map('map', {
                center: [37.6173, 55.7558],
                zoom: 15,
                key: 'ab7b70c9-9132-468f-8b4c-87177a2418cf',
            });
    
            navigator.geolocation.getCurrentPosition(function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                fetch('/save_user_location/' + lat + '/' + lon);
    
                map.setCenter([lon, lat]);

                console.log(lat + ', ' + lon)

                const locations = {{ locations | tojson }};

                locations.forEach(location => {
                    const marker = new mapgl.HtmlMarker(map, {
                        coordinates: [location.point.lon, location.point.lat],
                        html: '\
                        <div class="row bg-color-base" style="width: 40px; height: 40px; border-radius: 50%;">\
                            <div style="height: 85%; width: 85%">\
                                <img class="expand-img" style="border-radius: 50%;" src="' + location.logo + '"></img>\
                            </div>\
                        </div>'
                    });
                });
            });
        </script>
    </body>
</html>